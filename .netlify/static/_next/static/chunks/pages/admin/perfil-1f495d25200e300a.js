(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1384],{4979:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/perfil",function(){return a(3024)}])},6490:function(e,n,a){"use strict";a.d(n,{Z:function(){return I}});var i=a(5893),t=a(7294),r=a(1163),o=a(8745),s=a(2635),l=a(8539),c=a(6788),h=a(2857),d=a(6912),u=a(7407),x=a(9304),m=a(2311),p=a(7638),f=a(2200),Z=a(3490),v=a(6795),j=a(8690),g=a(5895),b=a(5076),S=a(5972),C=a(7958),y=a(190),w=a(3246),z=a(8155),A=a(6117),M=a(5854),k=a(9021),H=a(3905),E=a(899),P=a(237),V=a(1897),D=a(2874);function I(e){var n;let{children:a,title:I}=e,{user:N,logout:_}=(0,D.aC)(),W=(0,r.useRouter)(),L=(0,o.Z)(),T=(0,s.Z)(L.breakpoints.down("md")),[O,R]=(0,t.useState)(!1),[G,U]=(0,t.useState)(null),q=!!G,F=[{text:"Dashboard",icon:(0,i.jsx)(y.Z,{}),path:"/admin"},{text:"Usu\xe1rios",icon:(0,i.jsx)(w.Z,{}),path:"/admin/usuarios"},{text:"Motoristas",icon:(0,i.jsx)(z.Z,{}),path:"/admin/motoristas"},{text:"Controles",icon:(0,i.jsx)(A.Z,{}),path:"/admin/controles"},{text:"Configura\xe7\xf5es",icon:(0,i.jsx)(M.Z,{}),path:"/admin/configuracoes"}],X=()=>{R(!O)},Y=()=>{U(null)},B=(0,i.jsxs)("div",{children:[(0,i.jsxs)(l.Z,{children:[(0,i.jsx)(c.Z,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"Painel Admin"}),(0,i.jsx)(h.Z,{onClick:X,children:"rtl"===L.direction?(0,i.jsx)(k.Z,{}):(0,i.jsx)(H.Z,{})})]}),(0,i.jsx)(d.Z,{}),(0,i.jsx)(u.Z,{children:F.map(e=>(0,i.jsx)(x.ZP,{disablePadding:!0,onClick:()=>{W.push(e.path),T&&R(!1)},children:(0,i.jsxs)(m.Z,{selected:W.pathname===e.path,children:[(0,i.jsx)(p.Z,{children:e.icon}),(0,i.jsx)(f.Z,{primary:e.text})]})},e.text))})]});return(0,i.jsxs)(Z.Z,{sx:{display:"flex"},children:[(0,i.jsx)(v.Z,{position:"fixed",sx:{width:{sm:"calc(100% - ".concat(240,"px)")},ml:{sm:"".concat(240,"px")}},children:(0,i.jsxs)(l.Z,{children:[(0,i.jsx)(h.Z,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:X,sx:{mr:2,display:{sm:"none"}},children:(0,i.jsx)(E.Z,{})}),(0,i.jsx)(c.Z,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:I}),(0,i.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(c.Z,{variant:"body2",sx:{mr:2,display:{xs:"none",sm:"block"}},children:null==N?void 0:N.nome}),(0,i.jsx)(j.Z,{title:"Configura\xe7\xf5es da conta",children:(0,i.jsx)(h.Z,{onClick:e=>{U(e.currentTarget)},size:"small",sx:{ml:2},"aria-controls":q?"account-menu":void 0,"aria-haspopup":"true","aria-expanded":q?"true":void 0,children:(0,i.jsx)(g.Z,{sx:{width:32,height:32},children:(null==N?void 0:null===(n=N.nome)||void 0===n?void 0:n.charAt(0))||(0,i.jsx)(P.Z,{})})})})]})]})}),(0,i.jsxs)(b.Z,{anchorEl:G,id:"account-menu",open:q,onClose:Y,onClick:Y,PaperProps:{elevation:0,sx:{overflow:"visible",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,"& .MuiAvatar-root":{width:32,height:32,ml:-.5,mr:1},"&:before":{content:'""',display:"block",position:"absolute",top:0,right:14,width:10,height:10,bgcolor:"background.paper",transform:"translateY(-50%) rotate(45deg)",zIndex:0}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[(0,i.jsxs)(S.Z,{onClick:()=>{Y(),W.push("/admin/perfil")},children:[(0,i.jsx)(p.Z,{children:(0,i.jsx)(P.Z,{fontSize:"small"})}),"Perfil"]}),(0,i.jsx)(d.Z,{}),(0,i.jsxs)(S.Z,{onClick:()=>{Y(),_(),W.push("/login")},children:[(0,i.jsx)(p.Z,{children:(0,i.jsx)(V.Z,{fontSize:"small"})}),"Sair"]})]}),(0,i.jsxs)(Z.Z,{component:"nav",sx:{width:{sm:240},flexShrink:{sm:0}},"aria-label":"mailbox folders",children:[(0,i.jsx)(C.ZP,{variant:"temporary",open:O,onClose:X,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},children:B}),(0,i.jsx)(C.ZP,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},open:!0,children:B})]}),(0,i.jsx)(Z.Z,{component:"main",sx:{flexGrow:1,p:3,width:{sm:"calc(100% - ".concat(240,"px)")},marginTop:"64px",minHeight:"calc(100vh - 64px)",backgroundColor:L.palette.background.default},children:a})]})}},8264:function(e,n,a){"use strict";a.d(n,{Z:function(){return h}});var i=a(5893),t=a(1163),r=a(7294),o=a(2874),s=a(7182),l=a(3490),c=a(4178);function h(e){let{children:n}=e,{user:a,isAuthenticated:h,isLoading:d}=(0,o.aC)(),u=(0,t.useRouter)(),[x,m]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{if(!d){if(!h){console.log("[AdminRoute] Usu\xe1rio n\xe3o autenticado, redirecionando para login..."),u.push("/login");return}if(a&&a.tipo!==c.W.ADMIN){console.log("[AdminRoute] Acesso negado: usu\xe1rio n\xe3o \xe9 administrador"),u.push("/acesso-negado");return}m(!1)}},[d,h,a,u]),d||x)?(0,i.jsx)(l.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:(0,i.jsx)(s.Z,{})}):h&&(null==a?void 0:a.tipo)===c.W.ADMIN?(0,i.jsx)(i.Fragment,{children:n}):null}},237:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle")},6117:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m2 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Assignment")},3905:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft")},9021:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight")},190:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard")},1313:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},1897:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"ExitToApp")},8155:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping")},3246:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People")},8963:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save")},5854:function(e,n,a){"use strict";var i=a(3077),t=a(5893);n.Z=(0,i.Z)((0,t.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings")},3024:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return w}});var i=a(5893),t=a(7294),r=a(1163),o=a(3362),s=a(3490),l=a(7182),c=a(8426),h=a(8864),d=a(6788),u=a(4677),x=a(5895),m=a(492),p=a(6912),f=a(4925),Z=a(7788),v=a(1313),j=(0,a(3077).Z)((0,i.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),g=a(8963),b=a(2874),S=a(6490),C=a(8264);function y(){var e;let n=(0,t.useContext)(b.Vo);if(!n)throw Error("useAuth must be used within an AuthProvider");let{user:a,updateUser:C}=n;(0,r.useRouter)();let[y,w]=(0,t.useState)(!1),[z,A]=(0,t.useState)(!1),[M,k]=(0,t.useState)(null),[H,E]=(0,t.useState)(null),[P,V]=(0,t.useState)({nome:"",email:"",senhaAtual:"",novaSenha:"",confirmarSenha:""});(0,t.useEffect)(()=>{a&&V(e=>({...e,nome:a.nome||"",email:a.email||""}))},[a]);let D=e=>{let{name:n,value:a}=e.target;V(e=>({...e,[n]:a}))},I=()=>{if(!P.nome.trim())return k("O nome \xe9 obrigat\xf3rio"),!1;if(P.novaSenha||P.confirmarSenha){if(!P.senhaAtual)return k("A senha atual \xe9 obrigat\xf3ria para alterar a senha"),!1;if(P.novaSenha.length<6)return k("A nova senha deve ter pelo menos 6 caracteres"),!1;if(P.novaSenha!==P.confirmarSenha)return k("As senhas n\xe3o coincidem"),!1}return!0},N=async e=>{if(e.preventDefault(),I())try{A(!0),k(null);let e={nome:P.nome.trim(),email:P.email.trim()};P.novaSenha&&(e.senhaAtual=P.senhaAtual,e.novaSenha=P.novaSenha);let n=await o.h.put("/api/auth/perfil",e);C(n.data),E("Perfil atualizado com sucesso!"),w(!1),V(e=>({...e,senhaAtual:"",novaSenha:"",confirmarSenha:""})),setTimeout(()=>E(null),5e3)}catch(e){console.error("Erro ao atualizar perfil:",e),k(e.message||"Erro ao atualizar perfil. Tente novamente.")}finally{A(!1)}};return a?(0,i.jsxs)(S.Z,{title:"Meu Perfil",children:[(0,i.jsx)(c.Z,{maxWidth:"md",children:(0,i.jsxs)(h.Z,{elevation:3,sx:{p:4},children:[(0,i.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,i.jsx)(d.Z,{variant:"h5",component:"h1",children:"Meu Perfil"}),!y&&(0,i.jsx)(u.Z,{variant:"contained",color:"primary",startIcon:(0,i.jsx)(v.Z,{}),onClick:()=>{w(!0),k(null)},children:"Editar Perfil"})]}),(0,i.jsxs)(s.Z,{display:"flex",flexDirection:{xs:"column",md:"row"},gap:4,children:[(0,i.jsxs)(s.Z,{display:"flex",flexDirection:"column",alignItems:"center",mb:{xs:3,md:0},minWidth:200,children:[(0,i.jsx)(x.Z,{sx:{width:120,height:120,fontSize:48,mb:2},children:(null===(e=a.nome)||void 0===e?void 0:e.charAt(0).toUpperCase())||"U"}),(0,i.jsx)(d.Z,{variant:"h6",children:a.nome}),(0,i.jsx)(d.Z,{variant:"body2",color:"textSecondary",children:"ADMIN"===a.tipo?"Administrador":"GERENTE"===a.tipo?"Gerente":"Usu\xe1rio"}),(0,i.jsx)(d.Z,{variant:"body2",color:"textSecondary",children:a.email}),a.ultimoAcesso&&(0,i.jsxs)(d.Z,{variant:"caption",color:"textSecondary",mt:1,children:["\xdaltimo acesso: ",new Date(a.ultimoAcesso).toLocaleString()]})]}),(0,i.jsx)(s.Z,{flex:1,children:(0,i.jsxs)("form",{onSubmit:N,children:[(0,i.jsx)(m.Z,{label:"Nome Completo",name:"nome",value:P.nome,onChange:D,fullWidth:!0,margin:"normal",required:!0,disabled:!y||z}),(0,i.jsx)(m.Z,{label:"E-mail",name:"email",type:"email",value:P.email,onChange:D,fullWidth:!0,margin:"normal",required:!0,disabled:!y||z}),y&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.Z,{sx:{my:3},children:(0,i.jsx)(d.Z,{variant:"body2",color:"textSecondary",children:"Alterar Senha (opcional)"})}),(0,i.jsx)(m.Z,{label:"Senha Atual",name:"senhaAtual",type:"password",value:P.senhaAtual,onChange:D,fullWidth:!0,margin:"normal",disabled:z}),(0,i.jsx)(m.Z,{label:"Nova Senha",name:"novaSenha",type:"password",value:P.novaSenha,onChange:D,fullWidth:!0,margin:"normal",disabled:z,helperText:"Deixe em branco para manter a senha atual"}),(0,i.jsx)(m.Z,{label:"Confirmar Nova Senha",name:"confirmarSenha",type:"password",value:P.confirmarSenha,onChange:D,fullWidth:!0,margin:"normal",disabled:z})]}),y&&(0,i.jsxs)(s.Z,{mt:3,display:"flex",justifyContent:"flex-end",gap:2,children:[(0,i.jsx)(u.Z,{variant:"outlined",color:"inherit",onClick:()=>{w(!1),V(e=>({...e,senhaAtual:"",novaSenha:"",confirmarSenha:""})),k(null)},disabled:z,startIcon:(0,i.jsx)(j,{}),children:"Cancelar"}),(0,i.jsx)(u.Z,{type:"submit",variant:"contained",color:"primary",disabled:z,startIcon:z?(0,i.jsx)(l.Z,{size:20}):(0,i.jsx)(g.Z,{}),children:z?"Salvando...":"Salvar Altera\xe7\xf5es"})]})]})})]})]})}),(0,i.jsx)(f.Z,{open:!!M,autoHideDuration:6e3,onClose:()=>k(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,i.jsx)(Z.Z,{onClose:()=>k(null),severity:"error",sx:{width:"100%"},children:M})}),(0,i.jsx)(f.Z,{open:!!H,autoHideDuration:6e3,onClose:()=>E(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,i.jsx)(Z.Z,{onClose:()=>E(null),severity:"success",sx:{width:"100%"},children:H})})]}):(0,i.jsx)(s.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,i.jsx)(l.Z,{})})}function w(){return(0,i.jsx)(C.Z,{children:(0,i.jsx)(y,{})})}}},function(e){e.O(0,[8426,492,8690,6875,2888,9774,179],function(){return e(e.s=4979)}),_N_E=e.O()}]);