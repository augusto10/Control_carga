(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3988],{7307:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/controles",function(){return n(7974)}])},8264:function(e,a,n){"use strict";n.d(a,{Z:function(){return c}});var t=n(5893),r=n(1163),i=n(7294),o=n(2874),s=n(7182),d=n(3490),l=n(4178);function c(e){let{children:a}=e,{user:n,isAuthenticated:c,isLoading:u}=(0,o.aC)(),m=(0,r.useRouter)(),[h,f]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{if(!u){if(!c){console.log("[AdminRoute] Usu\xe1rio n\xe3o autenticado, redirecionando para login..."),m.push("/login");return}if(n&&n.tipo!==l.W.ADMIN){console.log("[AdminRoute] Acesso negado: usu\xe1rio n\xe3o \xe9 administrador"),m.push("/acesso-negado");return}f(!1)}},[u,c,n,m]),u||h)?(0,t.jsx)(d.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:(0,t.jsx)(s.Z,{})}):c&&(null==n?void 0:n.tipo)===l.W.ADMIN?(0,t.jsx)(t.Fragment,{children:a}):null}},9203:function(e,a,n){"use strict";var t=n(3077),r=n(5893);a.Z=(0,t.Z)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},1313:function(e,a,n){"use strict";var t=n(3077),r=n(5893);a.Z=(0,t.Z)((0,r.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},3947:function(e,a,n){"use strict";var t=n(3077),r=n(5893);a.Z=(0,t.Z)((0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")},7952:function(e,a,n){"use strict";n.d(a,{Z:function(){return c}});var t={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 m\xeas",other:"cerca de {{count}} meses"},xMonths:{one:"1 m\xeas",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},r=n(47),i={date:(0,r.Z)({formats:{full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},defaultWidth:"full"}),time:(0,r.Z)({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:(0,r.Z)({formats:{full:"{{date}} '\xe0s' {{time}}",long:"{{date}} '\xe0s' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},o={lastWeek:function(e){var a=e.getUTCDay();return"'"+(0===a||6===a?"\xfaltimo":"\xfaltima")+"' eeee '\xe0s' p"},yesterday:"'ontem \xe0s' p",today:"'hoje \xe0s' p",tomorrow:"'amanh\xe3 \xe0s' p",nextWeek:"eeee '\xe0s' p",other:"P"},s=n(2834),d={ordinalNumber:function(e,a){var n=Number(e);return(null==a?void 0:a.unit)==="week"?n+"\xaa":n+"\xba"},era:(0,s.Z)({values:{narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},defaultWidth:"wide"}),quarter:(0,s.Z)({values:{narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1\xba trimestre","2\xba trimestre","3\xba trimestre","4\xba trimestre"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:(0,s.Z)({values:{narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","mar\xe7o","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},defaultWidth:"wide"}),day:(0,s.Z)({values:{narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","ter\xe7a","quarta","quinta","sexta","s\xe1bado"],wide:["domingo","segunda-feira","ter\xe7a-feira","quarta-feira","quinta-feira","sexta-feira","s\xe1bado"]},defaultWidth:"wide"}),dayPeriod:(0,s.Z)({values:{narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh\xe3",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh\xe3",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh\xe3",afternoon:"tarde",evening:"tarde",night:"noite"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh\xe3",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh\xe3",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh\xe3",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},defaultFormattingWidth:"wide"})},l=n(7632),c={code:"pt-BR",formatDistance:function(e,a,n){var r,i=t[e];return(r="string"==typeof i?i:1===a?i.one:i.other.replace("{{count}}",String(a)),null!=n&&n.addSuffix)?n.comparison&&n.comparison>0?"em "+r:"h\xe1 "+r:r},formatLong:i,formatRelative:function(e,a,n,t){var r=o[e];return"function"==typeof r?r(a):r},localize:d,match:{ordinalNumber:(0,n(6669).Z)({matchPattern:/^(\d+)[ºªo]?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:(0,l.Z)({matchPatterns:{narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},defaultParseWidth:"any"}),quarter:(0,l.Z)({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:(0,l.Z)({matchPatterns:{narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|março|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},defaultParseWidth:"any"}),day:(0,l.Z)({matchPatterns:{narrow:/^(dom|[23456]ª?|s[aá]b)/i,short:/^(dom|[23456]ª?|s[aá]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[aá]b)/i,wide:/^(domingo|(segunda|ter[cç]a|quarta|quinta|sexta)([- ]feira)?|s[aá]bado)/i},defaultMatchWidth:"wide",parsePatterns:{short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aá]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aá]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[aá]b/i]},defaultParseWidth:"any"}),dayPeriod:(0,l.Z)({matchPatterns:{narrow:/^(a|p|mn|md|(da) (manhã|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manhã|tarde|noite))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manhã/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}}},7974:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return I}});var t=n(5893),r=n(7294),i=n(8426),o=n(7788),s=n(3490),d=n(7182),l=n(6788),c=n(4677),u=n(8864),m=n(5026),h=n(6592),f=n(360),p=n(6577),g=n(8863),j=n(9827),x=n(1873),Z=n(2857),v=n(3453),b=n(2365),y=n(110),w=n(492),C=n(6897),M=n(8649),A=n(5083),E=n(5972),z=n(6727),W=n(4925),S=n(3947),N=n(1313),D=n(9203),P=n(2874),q=n(8264),k=n(3362),T=n(4395),O=n(7952);function H(){let{user:e}=(0,P.aC)(),[a,n]=(0,r.useState)([]),[q,H]=(0,r.useState)(!0),[I,_]=(0,r.useState)(null),[L,F]=(0,r.useState)(!1),[R,X]=(0,r.useState)(null),[B,Y]=(0,r.useState)(!1),[U,V]=(0,r.useState)({open:!1,message:"",severity:"success"});(0,r.useEffect)(()=>{Q()},[]);let Q=async()=>{try{H(!0);let e=await k.h.get("/api/controles");n(e.data)}catch(a){console.error("Erro ao carregar controles:",a);let e=a instanceof Error?a.message:"Erro ao carregar controles";_("Erro ao carregar controles: ".concat(e))}finally{H(!1)}},G=e=>{X({...e,motorista:e.motorista||"",responsavel:e.responsavel||""}),Y(!0),F(!0)},J=()=>{F(!1),X(null)},K=e=>{let{name:a,value:n}=e.target;X(e=>({...e,[a]:n}))},$=async e=>{if(e.preventDefault(),R)try{H(!0),B&&R.id&&(await k.h.put("/api/controles/".concat(R.id),R),V({open:!0,message:"Controle atualizado com sucesso!",severity:"success"})),J(),await Q()}catch(e){console.error("Erro ao salvar controle:",e),V({open:!0,message:e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data&&"object"==typeof e.response.data&&"message"in e.response.data?String(e.response.data.message):"Erro ao salvar controle",severity:"error"})}finally{H(!1)}},ee=async e=>{if(window.confirm("Tem certeza que deseja finalizar este controle?"))try{H(!0),await k.h.patch("/api/controles/".concat(e,"/finalizar")),await Q(),V({open:!0,message:"Controle finalizado com sucesso!",severity:"success"})}catch(e){console.error("Erro ao finalizar controle:",e),V({open:!0,message:e&&"object"==typeof e&&"response"in e&&e.response&&"object"==typeof e.response&&"data"in e.response&&e.response.data&&"object"==typeof e.response.data&&"message"in e.response.data?String(e.response.data.message):"Erro ao finalizar controle",severity:"error"})}finally{H(!1)}},ea=()=>{V(e=>({...e,open:!1}))},en=e=>{switch(e){case"ABERTO":return"primary";case"EM_ANDAMENTO":return"info";case"FINALIZADO":return"success";case"CANCELADO":return"error";default:return"default"}},et=e=>{switch(e){case"ABERTO":return"Aberto";case"EM_ANDAMENTO":return"Em Andamento";case"FINALIZADO":return"Finalizado";case"CANCELADO":return"Cancelado";default:return e}};return I?(0,t.jsx)(i.Z,{maxWidth:"lg",sx:{mt:4,mb:4},children:(0,t.jsx)(o.Z,{severity:"error",children:I})}):q&&!L?(0,t.jsx)(s.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:(0,t.jsx)(d.Z,{})}):(0,t.jsxs)(i.Z,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,t.jsxs)(s.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,t.jsx)(l.Z,{variant:"h4",component:"h1",children:"Gerenciar Controles"}),(0,t.jsx)(c.Z,{variant:"contained",color:"primary",startIcon:(0,t.jsx)(S.Z,{}),onClick:Q,disabled:q,children:"Atualizar"})]}),(0,t.jsx)(u.Z,{sx:{width:"100%",overflow:"hidden",mb:3},children:(0,t.jsx)(m.Z,{sx:{maxHeight:600},children:(0,t.jsxs)(h.Z,{stickyHeader:!0,children:[(0,t.jsx)(f.Z,{children:(0,t.jsxs)(p.Z,{children:[(0,t.jsx)(g.Z,{children:"N\xfamero"}),(0,t.jsx)(g.Z,{children:"Motorista"}),(0,t.jsx)(g.Z,{children:"Respons\xe1vel"}),(0,t.jsx)(g.Z,{children:"Notas Fiscais"}),(0,t.jsx)(g.Z,{children:"Status"}),(0,t.jsx)(g.Z,{children:"Data Cria\xe7\xe3o"}),(0,t.jsx)(g.Z,{children:"Usu\xe1rio"}),(0,t.jsx)(g.Z,{align:"right",children:"A\xe7\xf5es"})]})}),(0,t.jsxs)(j.Z,{children:[a.map(e=>{var a;return(0,t.jsxs)(p.Z,{children:[(0,t.jsx)(g.Z,{children:e.numero}),(0,t.jsx)(g.Z,{children:e.motorista||"-"}),(0,t.jsx)(g.Z,{children:e.responsavel||"-"}),(0,t.jsx)(g.Z,{children:e.notasFiscais&&e.notasFiscais.length>0?(0,t.jsx)(x.Z,{label:"".concat(e.notasFiscais.length," nota(s)"),size:"small",color:"primary",variant:"outlined"}):(0,t.jsx)(x.Z,{label:"Sem notas",size:"small",variant:"outlined"})}),(0,t.jsx)(g.Z,{children:(0,t.jsx)(x.Z,{label:et(e.status),color:en(e.status),size:"small"})}),(0,t.jsx)(g.Z,{children:(0,T.Z)(new Date(e.dataCriacao),"dd/MM/yyyy HH:mm",{locale:O.Z})}),(0,t.jsx)(g.Z,{children:(null===(a=e.usuario)||void 0===a?void 0:a.nome)||"-"}),(0,t.jsxs)(g.Z,{align:"right",children:[(0,t.jsx)(Z.Z,{onClick:()=>G(e),color:"primary",size:"small",children:(0,t.jsx)(N.Z,{fontSize:"small"})}),"FINALIZADO"!==e.status&&(0,t.jsx)(Z.Z,{onClick:()=>ee(e.id),color:"success",size:"small",disabled:"CANCELADO"===e.status,children:(0,t.jsx)(D.Z,{fontSize:"small"})})]})]},e.id)}),0===a.length&&(0,t.jsx)(p.Z,{children:(0,t.jsx)(g.Z,{colSpan:8,align:"center",sx:{py:3},children:(0,t.jsx)(l.Z,{color:"textSecondary",children:"Nenhum controle encontrado"})})})]})]})})}),(0,t.jsx)(v.Z,{open:L,onClose:J,maxWidth:"sm",fullWidth:!0,children:(0,t.jsxs)("form",{onSubmit:$,children:[(0,t.jsx)(b.Z,{children:"Editar Controle"}),(0,t.jsx)(y.Z,{children:(0,t.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,t.jsx)(w.Z,{label:"N\xfamero",name:"numero",value:(null==R?void 0:R.numero)||"",onChange:K,required:!0,fullWidth:!0,margin:"normal",disabled:!0}),(0,t.jsx)(w.Z,{label:"Motorista",name:"motorista",value:(null==R?void 0:R.motorista)||"",onChange:K,required:!0,fullWidth:!0,margin:"normal"}),(0,t.jsx)(w.Z,{label:"Respons\xe1vel",name:"responsavel",value:(null==R?void 0:R.responsavel)||"",onChange:K,required:!0,fullWidth:!0,margin:"normal"}),(0,t.jsxs)(C.Z,{fullWidth:!0,margin:"normal",children:[(0,t.jsx)(M.Z,{id:"status-controle-label",children:"Status"}),(0,t.jsxs)(A.Z,{labelId:"status-controle-label",name:"status",value:(null==R?void 0:R.status)||"ABERTO",onChange:e=>{let{value:a}=e.target;X(e=>({...e,status:a}))},label:"Status",required:!0,children:[(0,t.jsx)(E.Z,{value:"ABERTO",children:"Aberto"}),(0,t.jsx)(E.Z,{value:"EM_ANDAMENTO",children:"Em Andamento"}),(0,t.jsx)(E.Z,{value:"FINALIZADO",children:"Finalizado"}),(0,t.jsx)(E.Z,{value:"CANCELADO",children:"Cancelado"})]})]})]})}),(0,t.jsxs)(z.Z,{children:[(0,t.jsx)(c.Z,{onClick:J,color:"inherit",children:"Cancelar"}),(0,t.jsx)(c.Z,{type:"submit",color:"primary",variant:"contained",disabled:q,children:q?(0,t.jsx)(d.Z,{size:24}):"Salvar"})]})]})}),(0,t.jsx)(W.Z,{open:U.open,autoHideDuration:6e3,onClose:ea,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,t.jsx)(o.Z,{onClose:ea,severity:U.severity,sx:{width:"100%"},children:U.message})})]})}function I(){return(0,t.jsx)(q.Z,{children:(0,t.jsx)(H,{})})}}},function(e){e.O(0,[8426,492,4424,6875,4793,1873,4395,2888,9774,179],function(){return e(e.s=7307)}),_N_E=e.O()}]);