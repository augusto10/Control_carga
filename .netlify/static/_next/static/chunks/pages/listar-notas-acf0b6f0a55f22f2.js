(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3685],{9046:function(t,o,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/listar-notas",function(){return e(2044)}])},2044:function(t,o,e){"use strict";e.r(o),e.d(o,{default:function(){return j}});var r=e(5893),a=e(7294),n=e(8426),s=e(6788),i=e(3490),c=e(492),l=e(4677),u=e(7182),d=e(5026),f=e(8864),h=e(6592),p=e(360),g=e(6577),m=e(8863),E=e(9827),v=e(1873),x=e(8690),w=e(2857),y=(0,e(3077).Z)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"}),"DeleteRounded"),b=e(5659),S=e(4395),j=()=>{let[t,o]=(0,a.useState)(!0),[e,j]=(0,a.useState)(""),[C,z]=(0,a.useState)(""),{notas:N,fetchNotas:P}=(0,b.o)();return(0,a.useEffect)(()=>{(async()=>{await P(e,C),o(!1)})()},[P,e,C]),(0,r.jsxs)(n.Z,{maxWidth:"sm",children:[(0,r.jsx)(s.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"Consultar Notas"}),(0,r.jsxs)(i.Z,{sx:{display:"flex",gap:2,mb:2},children:[(0,r.jsx)(c.Z,{label:"Data in\xedcio",type:"date",InputLabelProps:{shrink:!0},value:e,onChange:t=>j(t.target.value)}),(0,r.jsx)(c.Z,{label:"Data fim",type:"date",InputLabelProps:{shrink:!0},value:C,onChange:t=>z(t.target.value)}),(0,r.jsx)(l.Z,{variant:"contained",onClick:()=>o(!0),children:"Filtrar"})]}),t?(0,r.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(u.Z,{})}):(0,r.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:(0,r.jsx)(d.Z,{component:f.Z,sx:{mt:3,borderRadius:3,boxShadow:4,overflowX:"auto",width:"90%",maxWidth:1200,minWidth:700},children:(0,r.jsxs)(h.Z,{size:"small",children:[(0,r.jsx)(p.Z,{children:(0,r.jsxs)(g.Z,{sx:{backgroundColor:"#ff9800",height:48},children:[(0,r.jsx)(m.Z,{sx:{color:"#fff",fontWeight:"bold",fontSize:15,px:2},children:"Data"}),(0,r.jsx)(m.Z,{sx:{color:"#fff",fontWeight:"bold",fontSize:15,px:2},children:"N\xfamero da Nota"}),(0,r.jsx)(m.Z,{sx:{color:"#fff",fontWeight:"bold",fontSize:15,px:2},children:"Status"}),(0,r.jsx)(m.Z,{sx:{color:"#fff",fontWeight:"bold",fontSize:15,px:2},children:"A\xe7\xf5es"})]})}),(0,r.jsx)(E.Z,{children:N.map((t,o)=>(0,r.jsxs)(g.Z,{sx:{backgroundColor:o%2==0?"#fff9f1":"#fff",height:54},children:[(0,r.jsx)(m.Z,{sx:{minWidth:120,fontSize:14,py:1,px:2},children:t.dataCriacao?(0,S.Z)(new Date(t.dataCriacao),"dd/MM/yyyy"):"-"}),(0,r.jsx)(m.Z,{sx:{minWidth:120,fontSize:14,py:1,px:2},children:t.numeroNota}),(0,r.jsx)(m.Z,{children:t.controleId?(0,r.jsx)(v.Z,{label:"Em carga",color:"success",size:"small",sx:{minWidth:90,fontWeight:600,letterSpacing:.5,fontSize:13,height:28,px:1}}):(0,r.jsx)(v.Z,{label:"Dispon\xedvel",color:"warning",size:"small",sx:{minWidth:90,fontWeight:600,letterSpacing:.5,fontSize:13,height:28,px:1}})}),(0,r.jsx)(m.Z,{children:!t.controleId&&(0,r.jsx)(x.Z,{title:"Excluir Nota",children:(0,r.jsx)(w.Z,{onClick:()=>{var o;return o=t.id,void alert("Excluir nota ".concat(o," (implementar a\xe7\xe3o real)"))},size:"small",sx:{ml:1,color:"#ff5722",bgcolor:"#fff3e0",borderRadius:2,"&:hover":{bgcolor:"#ffe0b2",color:"#d84315"}},children:(0,r.jsx)(y,{fontSize:"small"})})})})]},t.id))})]})})})]})}},5659:function(t,o,e){"use strict";e.d(o,{o:function(){return r}});let r=(0,e(4529).Ue)(t=>({notas:[],controles:[],transportadoras:[],status:null,loading:!1,fetchNotas:async(o,e)=>{let r=new URLSearchParams;o&&r.append("start",o),e&&r.append("end",e);let a=await fetch("/api/notas".concat(r.toString()?"?"+r.toString():""),{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});t({notas:await a.json()})},fetchControles:async()=>{console.log("Iniciando fetchControles..."),t({loading:!0});try{let o=await fetch("/api/controles",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});if(console.log("Resposta do fetchControles recebida, status:",o.status),!o.ok){console.error("Erro ao buscar controles:",o.status,o.statusText);let t=await o.json().catch(()=>({}));throw console.error("Detalhes do erro:",t),Error(t.error||"Erro ao buscar controles")}let e=await o.json();console.log("Controles carregados com sucesso, quantidade:",e.length),t({controles:e,loading:!1})}catch(o){throw console.error("Erro em fetchControles:",o),t({loading:!1}),o}},fetchTransportadoras:async()=>{t({loading:!0});try{let o=await fetch("/api/transportadoras",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});if(!o.ok){let t=await o.json().catch(()=>({}));throw Error(t.error||"Erro ao buscar transportadoras")}let e=await o.json();return t({transportadoras:e,loading:!1}),e}catch(o){throw console.error("Erro ao buscar transportadoras:",o),t({loading:!1}),o}},addNota:async o=>{try{if(console.log("Dados sendo enviados:",o),!(await fetch("/api/auth/me",{credentials:"include"})).ok)throw Error("Usu\xe1rio n\xe3o autenticado");let e=await fetch("/api/addNota",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify(o)});if(console.log("Status da resposta:",e.status),401===e.status)throw window.dispatchEvent(new Event("unauthorized")),Error("Sess\xe3o expirada. Por favor, fa\xe7a login novamente.");if(!e.ok){let t;try{t=await e.json(),console.error("Detalhes do erro:",t)}catch(o){t=await e.text()}let o="object"==typeof t?t.error||t.message||"Erro desconhecido":t||"Erro ao processar a requisi\xe7\xe3o";throw Error("Erro ao salvar nota: ".concat(e.status," - ").concat(o))}let r=await e.json();return t(t=>({notas:[...t.notas,r],status:"success"})),r}catch(o){throw console.error("Erro ao adicionar nota:",o),t(t=>({...t,status:"error"})),(o.message.includes("n\xe3o autenticado")||o.message.includes("Sess\xe3o expirada"))&&window.dispatchEvent(new Event("unauthorized")),o}},criarControle:async o=>{try{var e,r;let a;if(console.log("[criarControle] Dados recebidos:",JSON.stringify(o,null,2)),!(null===(e=o.motorista)||void 0===e?void 0:e.trim()))throw Error("Nome do motorista \xe9 obrigat\xf3rio");if(!(null===(r=o.responsavel)||void 0===r?void 0:r.trim()))throw Error("Nome do respons\xe1vel \xe9 obrigat\xf3rio");if(console.log("[criarControle] Transportadora recebida:",o.transportadora),!["ACERT","EXPRESSO_GOIAS"].includes(o.transportadora))throw console.error("[criarControle] Transportadora inv\xe1lida:",o.transportadora),Error("Transportadora inv\xe1lida. Valor recebido: "+o.transportadora);let n=Array.isArray(o.notasIds)?o.notasIds:[],s={...o,motorista:o.motorista.trim(),responsavel:o.responsavel.trim(),cpfMotorista:o.cpfMotorista?o.cpfMotorista.replace(/[^\d]/g,""):"PENDENTE",qtdPallets:Number(o.qtdPallets)||0,observacao:o.observacao||null,notasIds:n};console.log("[criarControle] Dados formatados para envio:",JSON.stringify(s,null,2)),console.log("[criarControle] Enviando requisi\xe7\xe3o para /api/controles");let i=await fetch("/api/controles",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(s)});console.log("[criarControle] Resposta recebida. Status:",i.status);try{a=await i.json(),console.log("[criarControle] Corpo da resposta:",JSON.stringify(a,null,2))}catch(t){console.error("[criarControle] Erro ao fazer parse da resposta:",t),a={}}if(!i.ok){console.error("[criarControle] Erro na resposta da API. Status:",i.status),console.error("[criarControle] Dados do erro:",a);let t=a.error||a.message||"Erro ao criar controle: ".concat(i.status," ").concat(i.statusText);throw console.error("[criarControle] Mensagem de erro:",t),Error(t)}let c=a;if(n.length>0)try{let t=await fetch("/api/controles/vincular-notas",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({controleId:c.id,notasIds:n})});if(!t.ok){let o=await t.json().catch(()=>({}));console.warn("Aviso ao vincular notas:",o)}c.notas=n.map(t=>({id:t}))}catch(t){console.error("Erro ao vincular notas:",t)}try{let o=await fetch("/api/controles",{credentials:"include",headers:{Accept:"application/json"}});if(o.ok){let e=await o.json();t({controles:e})}}catch(t){console.error("Erro ao atualizar lista de controles:",t)}return c}catch(t){if(console.error("Erro na fun\xe7\xe3o criarControle:",t),t instanceof Error)throw t;throw Error("Erro desconhecido ao criar controle")}},vincularNotas:async(t,o)=>{await fetch("/api/controles/vincular-notas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({controleId:t,notasIds:o})}),await Promise.all([r.getState().fetchNotas(),r.getState().fetchControles()])},finalizarControle:async t=>{await fetch("/api/controles/finalizar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({controleId:t})}),await r.getState().fetchControles()},atualizarControle:async(t,o)=>{console.log("Iniciando atualizarControle...");try{console.log("Enviando requisi\xe7\xe3o para /api/controles/atualizar com dados:",{controleId:t,...o,qtdPallets:Number(o.qtdPallets)||0});let e=await fetch("/api/controles/atualizar",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},body:JSON.stringify({controleId:t,...o,qtdPallets:Number(o.qtdPallets)||0})});if(console.log("Resposta recebida, status:",e.status),!e.ok){console.error("Erro na resposta da API:",e.status,e.statusText);let t=await e.json().catch(()=>({}));throw console.error("Detalhes do erro:",t),Error(t.error||"Erro ao atualizar controle")}console.log("Atualizando lista de controles...");let a=await e.json();return await r.getState().fetchControles(),console.log("Controle atualizado com sucesso:",a),a}catch(t){return console.error("Erro ao atualizar controle:",t),null}}}))},83:function(t,o,e){"use strict";var r=e(7294),a="function"==typeof Object.is?Object.is:function(t,o){return t===o&&(0!==t||1/t==1/o)||t!=t&&o!=o},n=r.useState,s=r.useEffect,i=r.useLayoutEffect,c=r.useDebugValue;function l(t){var o=t.getSnapshot;t=t.value;try{var e=o();return!a(t,e)}catch(t){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,o){return o()}:function(t,o){var e=o(),r=n({inst:{value:e,getSnapshot:o}}),a=r[0].inst,u=r[1];return i(function(){a.value=e,a.getSnapshot=o,l(a)&&u({inst:a})},[t,e,o]),s(function(){return l(a)&&u({inst:a}),t(function(){l(a)&&u({inst:a})})},[t]),c(e),e};o.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},6251:function(t,o,e){"use strict";var r=e(7294),a=e(1688),n="function"==typeof Object.is?Object.is:function(t,o){return t===o&&(0!==t||1/t==1/o)||t!=t&&o!=o},s=a.useSyncExternalStore,i=r.useRef,c=r.useEffect,l=r.useMemo,u=r.useDebugValue;o.useSyncExternalStoreWithSelector=function(t,o,e,r,a){var d=i(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;var h=s(t,(d=l(function(){function t(t){if(!c){if(c=!0,s=t,t=r(t),void 0!==a&&f.hasValue){var o=f.value;if(a(o,t))return i=o}return i=t}if(o=i,n(s,t))return o;var e=r(t);return void 0!==a&&a(o,e)?(s=t,o):(s=t,i=e)}var s,i,c=!1,l=void 0===e?null:e;return[function(){return t(o())},null===l?void 0:function(){return t(l())}]},[o,e,r,a]))[0],d[1]);return c(function(){f.hasValue=!0,f.value=h},[h]),u(h),h}},1688:function(t,o,e){"use strict";t.exports=e(83)},2798:function(t,o,e){"use strict";t.exports=e(6251)},4529:function(t,o,e){"use strict";e.d(o,{Ue:function(){return f}});let r=t=>{let o;let e=new Set,r=(t,r)=>{let a="function"==typeof t?t(o):t;if(!Object.is(a,o)){let t=o;o=(null!=r?r:"object"!=typeof a||null===a)?a:Object.assign({},o,a),e.forEach(e=>e(o,t))}},a=()=>o,n={setState:r,getState:a,getInitialState:()=>s,subscribe:t=>(e.add(t),()=>e.delete(t)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),e.clear()}},s=o=t(r,a,n);return n},a=t=>t?r(t):r;var n=e(7294),s=e(2798);let{useDebugValue:i}=n,{useSyncExternalStoreWithSelector:c}=s,l=!1,u=t=>t,d=t=>{"function"!=typeof t&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let o="function"==typeof t?a(t):t,e=(t,e)=>(function(t,o=u,e){e&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);let r=c(t.subscribe,t.getState,t.getServerState||t.getInitialState,o,e);return i(r),r})(o,t,e);return Object.assign(e,o),e},f=t=>t?d(t):d}},function(t){t.O(0,[8426,492,8690,4424,1873,4395,2888,9774,179],function(){return t(t.s=9046)}),_N_E=t.O()}]);