"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7604],{7604:function(e,o,t){t.r(o),t.d(o,{default:function(){return E}});var a=t(2729),r=t(5893),n=t(7294),s=t(8745),i=t(2635),l=t(917),c=t(8864),d=t(3490),u=t(6788),p=t(4677),h=t(7182),m=t(492),v=t(2857),f=t(5611),g=t(9496),b=t(5659),y=t(9090),x=t(8963),w=(0,t(3077).Z)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),j=t(3839);function S(){let e=(0,a._)(["\n    0% { opacity: 0.7; }\n    50% { opacity: 0.4; }\n    100% { opacity: 0.7; }\n  "]);return S=function(){return e},e}var E=()=>{let[e,o]=(0,n.useState)([]),[t,a]=(0,n.useState)(!1),[E,C]=(0,n.useState)(!1),[Z,N]=(0,n.useState)(""),[D,z]=(0,n.useState)(""),[T,P]=(0,n.useState)(""),[I,k]=(0,n.useState)("0,00"),[O,A]=(0,n.useState)(null),R=(0,n.useRef)(null),{enqueueSnackbar:q}=(0,g.Ds)(),{addNota:H}=(0,b.o)(),M=(0,s.Z)();(0,i.Z)(M.breakpoints.down("sm"));let L=e=>{let o=e.trim();return o?/^\d+$/.test(o)?44===o.length||o.length>=1&&o.length<=20?{valido:!0}:{valido:!1,erro:"C\xf3digo inv\xe1lido. Deve ter 44 d\xedgitos (DANFE) ou at\xe9 20 d\xedgitos."}:/^[A-Za-z0-9-]{1,50}$/.test(o)?{valido:!0}:{valido:!1,erro:"Formato de c\xf3digo inv\xe1lido. Use apenas n\xfameros, letras ou h\xedfen."}:{valido:!1,erro:"O c\xf3digo de barras n\xe3o pode estar vazio"}},V=e=>{let o=e.replace(/[^\d]/g,"");if(44===o.length)return o.substring(25,34);if(o.length>44)for(let e=0;e<=o.length-44;e++){let t=o.substring(e,e+44);if(["8","9"].includes(t[0]))return t.substring(25,34)}if(e.includes("-")){let o=e.split("-");return o[1]?o[1].replace(/[^\d]/g,""):""}return o.length<=20?o:o.slice(-9)},J=(e,t)=>{o(o=>o.map(o=>o.id===e?{...o,volumes:t}:o))},W=(0,n.useCallback)(async t=>{if(!t.trim())return;console.log("Processando c\xf3digo de barras:",t=t.trim());let r=L(t);if(!r.valido){let e=r.erro||"C\xf3digo de barras inv\xe1lido";console.warn(e,t),N(e),q(e,{variant:"error",autoHideDuration:5e3,preventDuplicate:!0});return}a(!0),N("");try{let a=t.trim();console.log("C\xf3digo limpo:",a);let r=V(a);if(console.log("N\xfamero da nota extra\xeddo:",r),!r)throw Error("N\xe3o foi poss\xedvel extrair o n\xfamero da nota do c\xf3digo de barras");let n=r.replace(/^0+/,"");if(e.find(e=>e.codigo&&a&&e.codigo===a||e.numeroNota&&e.numeroNota===n)){q("Nota j\xe1 escaneada anteriormente",{variant:"warning",autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"}});return}let s={id:Date.now().toString(),codigo:a,numeroNota:n,volumes:"1",isScanned:!0,status:"pendente",dataHora:new Date().toLocaleString("pt-BR"),editando:!0};A(s.id),console.log("Nova nota a ser adicionada:",s),o(e=>{let o=[...e,s];return console.log("Lista de notas atualizada:",o),o}),q("Nota ".concat(n," adicionada com sucesso!"),{variant:"success",autoHideDuration:3e3}),setTimeout(()=>{let e=document.querySelector('[data-nota-id="'.concat(s.id,'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})},100),setTimeout(()=>{R.current&&R.current.focus()},200)}catch(e){console.error("Erro ao processar c\xf3digo de barras:",e),N("Erro ao processar c\xf3digo de barras. Tente novamente."),q("Erro ao processar c\xf3digo de barras",{variant:"error",autoHideDuration:5e3})}finally{a(!1)}},[e,q]),F=t=>{let a={...e[t]};if(!a.volumes||isNaN(parseInt(a.volumes))||0>=parseInt(a.volumes)){q("Informe uma quantidade de volumes v\xe1lida",{variant:"error"});return}o(o=>{let r=[...o];return r[t]={...e[t],volumes:a.volumes,editando:!1},r}),A(null),q("Nota atualizada com sucesso!",{variant:"success"})},B=t=>{let a=e[t];a&&window.confirm("Tem certeza que deseja remover a nota ".concat(a.numeroNota,"?"))&&(o(e=>e.filter((e,o)=>o!==t)),q("Nota removida com sucesso!",{variant:"info",autoHideDuration:3e3}))},U=async()=>{if(0===e.length){q("Nenhuma nota para salvar.",{variant:"info"});return}try{C(!0);let t=e.map(e=>{let o={...e,volumes:e.volumes&&!isNaN(Number(e.volumes))?String(e.volumes):"1"};return console.log("Nota processada para envio:",JSON.stringify(o,null,2)),o});console.log("Dados a serem enviados:",JSON.stringify({notas:t},null,2));let a=await fetch("/api/notas/salvar-multiplas",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Cache:"no-cache",credentials:"include"},body:JSON.stringify({notas:t})});console.log("Resposta do servidor (status):",a.status);let r=await a.json();if(console.log("Resposta do servidor:",r),!a.ok){if("Nota j\xe1 escaneada anteriormente"===r.error||"Nota j\xe1 escaneada anteriormente"===r.message)throw Error("Nota j\xe1 escaneada anteriormente");throw Error(r.error||r.message||"Erro ao salvar notas")}q("Notas salvas com sucesso!",{variant:"success",autoHideDuration:3e3}),o([]),A(null),q("Notas salvas com sucesso!",{variant:"success",autoHideDuration:3e3})}catch(e){console.error("Erro ao salvar notas:",e),q(e instanceof Error?e.message:"Erro ao salvar notas",{variant:"error",autoHideDuration:5e3})}finally{C(!1)}},_=(0,l.F4)(S()),[X,$]=(0,n.useState)(!0);(0,n.useEffect)(()=>{O?setTimeout(()=>{let e=document.querySelector('[data-nota-id="'.concat(O,'"] .MuiInputBase-input'));e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"nearest"}))},100):R.current&&(R.current.focus(),X?$(!1):R.current.scrollIntoView({behavior:"smooth",block:"center"}))},[O,e.length,X]);let G=(0,n.useMemo)(()=>e.reduce((e,o)=>e+(parseInt(o.volumes)||0),0),[e]);return(0,r.jsxs)(d.Z,{children:[(0,r.jsxs)(c.Z,{component:"form",onSubmit:t=>{if(t.preventDefault(),!T.trim()){q("Informe o n\xfamero da nota",{variant:"error"});return}if(e.find(e=>e.numeroNota===T.trim())){q("Nota j\xe1 escaneada anteriormente",{variant:"warning",autoHideDuration:4e3,anchorOrigin:{vertical:"top",horizontal:"center"}});return}let a={id:Date.now().toString(),codigo:"MANUAL-".concat(Date.now()),numeroNota:T.trim(),volumes:"1",isScanned:!1,status:"pendente",dataHora:new Date().toLocaleString("pt-BR"),editando:!0};o(e=>[...e,a]),A(a.id),P(""),q("Nota ".concat(T," adicionada com sucesso!"),{variant:"success"}),setTimeout(()=>{let e=document.querySelector('[data-nota-id="'.concat(a.id,'"]'));e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},sx:{p:3,mb:3},children:[(0,r.jsx)(u.Z,{variant:"h6",gutterBottom:!0,children:"Leitor de C\xf3digo de Barras"}),(0,r.jsxs)(d.Z,{display:"flex",gap:2,alignItems:"flex-end",children:[(0,r.jsx)(m.Z,{fullWidth:!0,label:"Aponte o scanner e leia o c\xf3digo",variant:"outlined",value:D,onChange:e=>z(e.target.value),onKeyDown:e=>{"Enter"===e.key&&D.trim()&&(e.preventDefault(),W(D),z(""))},inputRef:R,disabled:t||E,autoFocus:!0,InputProps:{endAdornment:(0,r.jsx)(f.Z,{position:"end",children:(0,r.jsx)(v.Z,{onClick:()=>{var e;z(""),null===(e=R.current)||void 0===e||e.focus()},edge:"end",children:(0,r.jsx)(w,{})})})}}),(0,r.jsx)(p.Z,{type:"submit",variant:"contained",color:"primary",disabled:!D.trim()||t||E,startIcon:(0,r.jsx)(j.Z,{}),children:"Adicionar"})]}),(0,r.jsx)(u.Z,{variant:"caption",color:"textSecondary",display:"block",mt:1,children:"Posicione o cursor no campo acima e leia o c\xf3digo com o scanner"})]}),(0,r.jsxs)(c.Z,{sx:{p:3,mb:3},children:[(0,r.jsxs)(d.Z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,r.jsxs)(u.Z,{variant:"h6",children:["Notas a serem salvas ",(0,r.jsxs)("small",{children:["(",e.length,")"]})]}),e.length>0&&(0,r.jsxs)(d.Z,{display:"flex",gap:2,alignItems:"center",children:[(0,r.jsxs)(u.Z,{variant:"subtitle1",color:"primary",fontWeight:"bold",children:["Total de Volumes: ",G]}),(0,r.jsx)(p.Z,{color:"error",size:"small",variant:"outlined",onClick:()=>{window.confirm("Tem certeza que deseja remover todas as notas?")&&(o([]),q("Todas as notas foram removidas",{variant:"info",autoHideDuration:3e3}))},disabled:t||E,startIcon:(0,r.jsx)(y.Z,{}),children:"Limpar Tudo"}),(0,r.jsxs)(d.Z,{sx:{position:"relative"},children:[(0,r.jsx)(p.Z,{variant:"contained",color:"primary",onClick:U,disabled:t||E||0===e.length,startIcon:E?void 0:(0,r.jsx)(x.Z,{}),sx:{minWidth:180,"&.Mui-disabled":{bgcolor:"action.disabledBackground",color:"action.disabled"}},children:E?"Salvando...":"Salvar ".concat(e.length," Nota").concat(1!==e.length?"s":"")}),E&&(0,r.jsx)(h.Z,{size:24,sx:{color:"primary.main",position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]}),0===e.length?(0,r.jsx)(u.Z,{variant:"body2",color:"textSecondary",align:"center",sx:{py:4},children:"Nenhuma nota adicionada ainda. Use o scanner para adicionar notas."}):(0,r.jsx)(d.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:e.map((e,t)=>(0,r.jsxs)(c.Z,{elevation:1,"data-status":e.status,"data-nota-id":e.id,sx:{p:2,borderLeft:"4px solid",borderColor:"erro"===e.status?"error.main":"processando"===e.status?"warning.main":"concluido"===e.status?"success.main":"primary.main",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"background.paper",position:"relative",overflow:"hidden","&:hover":{boxShadow:2},..."processando"===e.status?{"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"warning.light",opacity:.1,animation:"".concat(_," 1.5s ease-in-out infinite"),zIndex:0}}:{}},children:[(0,r.jsxs)(d.Z,{sx:{flex:1},children:[(0,r.jsxs)(d.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,r.jsxs)(u.Z,{variant:"subtitle1",fontWeight:"bold",children:["NFE ",e.numeroNota]}),(0,r.jsx)(d.Z,{component:"span",sx:{px:1,py:.5,bgcolor:"primary.light",color:"primary.contrastText",borderRadius:1,fontSize:"0.7rem",fontWeight:"bold",textTransform:"uppercase"},children:e.status})]}),(0,r.jsxs)(u.Z,{variant:"body2",color:"text.secondary",children:["C\xf3digo: ",e.codigo]}),O===e.id?(0,r.jsxs)(d.Z,{mt:1,mb:1,children:[(0,r.jsx)(u.Z,{variant:"subtitle2",gutterBottom:!0,children:e.isScanned?"Digite a quantidade de volumes:":"Digite o valor da nota:"}),e.isScanned?(0,r.jsx)(m.Z,{label:"Volumes",type:"number",value:e.volumes,onChange:t=>{let a=t.target.value;o(o=>o.map(o=>o.id===e.id?{...o,volumes:a}:o))},autoFocus:!0,size:"small",sx:{maxWidth:"120px"},inputProps:{min:1,step:1,inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"center"}}}):(0,r.jsx)(m.Z,{label:"Volumes",type:"number",value:e.volumes,onChange:o=>J(e.id,o.target.value),autoFocus:!0,size:"small",sx:{maxWidth:"120px"},inputProps:{min:1,style:{textAlign:"center"}}}),(0,r.jsxs)(d.Z,{mt:1,display:"flex",gap:1,children:[(0,r.jsx)(p.Z,{variant:"contained",color:"primary",size:"small",onClick:()=>F(t),children:"Salvar"}),(0,r.jsx)(p.Z,{variant:"outlined",size:"small",onClick:()=>A(null),children:"Cancelar"})]})]}):(0,r.jsxs)(d.Z,{children:[(0,r.jsx)(d.Z,{onClick:()=>A(e.id),sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer","&:hover":{textDecoration:"underline"},color:e.isScanned?"primary.main":"inherit"},children:(0,r.jsx)(u.Z,{variant:"body2",children:"".concat(e.volumes," ").concat(1===parseInt(e.volumes)?"volume":"volumes")})}),(0,r.jsx)(u.Z,{variant:"caption",color:"text.secondary",display:"block",mt:.5,children:new Date(e.dataHora).toLocaleString("pt-BR")})]})]}),(0,r.jsx)(d.Z,{children:(0,r.jsx)(v.Z,{size:"small",color:"error",onClick:()=>B(t),disabled:E,title:"Remover nota",children:(0,r.jsx)(y.Z,{})})})]},e.id))})]})]})}},3839:function(e,o,t){var a=t(3077),r=t(5893);o.Z=(0,a.Z)((0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},9090:function(e,o,t){var a=t(3077),r=t(5893);o.Z=(0,a.Z)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},8963:function(e,o,t){var a=t(3077),r=t(5893);o.Z=(0,a.Z)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save")},5611:function(e,o,t){t.d(o,{Z:function(){return S}});var a,r=t(3366),n=t(7462),s=t(7294),i=t(512),l=t(4780),c=t(6643),d=t(6788),u=t(2276),p=t(7280),h=t(7527),m=t(1588),v=t(4867);function f(e){return(0,v.ZP)("MuiInputAdornment",e)}let g=(0,m.Z)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var b=t(4001),y=t(5893);let x=["children","className","component","disablePointerEvents","disableTypography","position","variant"],w=e=>{let{classes:o,disablePointerEvents:t,hiddenLabel:a,position:r,size:n,variant:s}=e,i={root:["root",t&&"disablePointerEvents",r&&"position".concat((0,c.Z)(r)),s,a&&"hiddenLabel",n&&"size".concat((0,c.Z)(n))]};return(0,l.Z)(i,f,o)},j=(0,h.ZP)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,o)=>{let{ownerState:t}=e;return[o.root,o["position".concat((0,c.Z)(t.position))],!0===t.disablePointerEvents&&o.disablePointerEvents,o[t.variant]]}})(e=>{let{theme:o,ownerState:t}=e;return(0,n.Z)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(o.vars||o).palette.action.active},"filled"===t.variant&&{["&.".concat(g.positionStart,"&:not(.").concat(g.hiddenLabel,")")]:{marginTop:16}},"start"===t.position&&{marginRight:8},"end"===t.position&&{marginLeft:8},!0===t.disablePointerEvents&&{pointerEvents:"none"})});var S=s.forwardRef(function(e,o){let t=(0,b.i)({props:e,name:"MuiInputAdornment"}),{children:l,className:c,component:h="div",disablePointerEvents:m=!1,disableTypography:v=!1,position:f,variant:g}=t,S=(0,r.Z)(t,x),E=(0,p.Z)()||{},C=g;g&&E.variant,E&&!C&&(C=E.variant);let Z=(0,n.Z)({},t,{hiddenLabel:E.hiddenLabel,size:E.size,disablePointerEvents:m,position:f,variant:C}),N=w(Z);return(0,y.jsx)(u.Z.Provider,{value:null,children:(0,y.jsx)(j,(0,n.Z)({as:h,ownerState:Z,className:(0,i.Z)(N.root,c),ref:o},S,{children:"string"!=typeof l||v?(0,y.jsxs)(s.Fragment,{children:["start"===f?a||(a=(0,y.jsx)("span",{className:"notranslate",children:"â€‹"})):null,l]}):(0,y.jsx)(d.Z,{color:"text.secondary",children:l})}))})})},5659:function(e,o,t){t.d(o,{o:function(){return a}});let a=(0,t(4529).Ue)(e=>({notas:[],controles:[],transportadoras:[],status:null,loading:!1,fetchNotas:async(o,t)=>{let a=new URLSearchParams;o&&a.append("start",o),t&&a.append("end",t);let r=await fetch("/api/notas".concat(a.toString()?"?"+a.toString():""),{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});e({notas:await r.json()})},fetchControles:async()=>{console.log("Iniciando fetchControles..."),e({loading:!0});try{let o=await fetch("/api/controles",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});if(console.log("Resposta do fetchControles recebida, status:",o.status),!o.ok){console.error("Erro ao buscar controles:",o.status,o.statusText);let e=await o.json().catch(()=>({}));throw console.error("Detalhes do erro:",e),Error(e.error||"Erro ao buscar controles")}let t=await o.json();console.log("Controles carregados com sucesso, quantidade:",t.length),e({controles:t,loading:!1})}catch(o){throw console.error("Erro em fetchControles:",o),e({loading:!1}),o}},fetchTransportadoras:async()=>{e({loading:!0});try{let o=await fetch("/api/transportadoras",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.error||"Erro ao buscar transportadoras")}let t=await o.json();return e({transportadoras:t,loading:!1}),t}catch(o){throw console.error("Erro ao buscar transportadoras:",o),e({loading:!1}),o}},addNota:async o=>{try{if(console.log("Dados sendo enviados:",o),!(await fetch("/api/auth/me",{credentials:"include"})).ok)throw Error("Usu\xe1rio n\xe3o autenticado");let t=await fetch("/api/addNota",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify(o)});if(console.log("Status da resposta:",t.status),401===t.status)throw window.dispatchEvent(new Event("unauthorized")),Error("Sess\xe3o expirada. Por favor, fa\xe7a login novamente.");if(!t.ok){let e;try{e=await t.json(),console.error("Detalhes do erro:",e)}catch(o){e=await t.text()}let o="object"==typeof e?e.error||e.message||"Erro desconhecido":e||"Erro ao processar a requisi\xe7\xe3o";throw Error("Erro ao salvar nota: ".concat(t.status," - ").concat(o))}let a=await t.json();return e(e=>({notas:[...e.notas,a],status:"success"})),a}catch(o){throw console.error("Erro ao adicionar nota:",o),e(e=>({...e,status:"error"})),(o.message.includes("n\xe3o autenticado")||o.message.includes("Sess\xe3o expirada"))&&window.dispatchEvent(new Event("unauthorized")),o}},criarControle:async o=>{try{var t,a;let r;if(console.log("[criarControle] Dados recebidos:",JSON.stringify(o,null,2)),!(null===(t=o.motorista)||void 0===t?void 0:t.trim()))throw Error("Nome do motorista \xe9 obrigat\xf3rio");if(!(null===(a=o.responsavel)||void 0===a?void 0:a.trim()))throw Error("Nome do respons\xe1vel \xe9 obrigat\xf3rio");if(console.log("[criarControle] Transportadora recebida:",o.transportadora),!["ACERT","EXPRESSO_GOIAS"].includes(o.transportadora))throw console.error("[criarControle] Transportadora inv\xe1lida:",o.transportadora),Error("Transportadora inv\xe1lida. Valor recebido: "+o.transportadora);let n=Array.isArray(o.notasIds)?o.notasIds:[],s={...o,motorista:o.motorista.trim(),responsavel:o.responsavel.trim(),cpfMotorista:o.cpfMotorista?o.cpfMotorista.replace(/[^\d]/g,""):"PENDENTE",qtdPallets:Number(o.qtdPallets)||0,observacao:o.observacao||null,notasIds:n};console.log("[criarControle] Dados formatados para envio:",JSON.stringify(s,null,2)),console.log("[criarControle] Enviando requisi\xe7\xe3o para /api/controles");let i=await fetch("/api/controles",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(s)});console.log("[criarControle] Resposta recebida. Status:",i.status);try{r=await i.json(),console.log("[criarControle] Corpo da resposta:",JSON.stringify(r,null,2))}catch(e){console.error("[criarControle] Erro ao fazer parse da resposta:",e),r={}}if(!i.ok){console.error("[criarControle] Erro na resposta da API. Status:",i.status),console.error("[criarControle] Dados do erro:",r);let e=r.error||r.message||"Erro ao criar controle: ".concat(i.status," ").concat(i.statusText);throw console.error("[criarControle] Mensagem de erro:",e),Error(e)}let l=r;if(n.length>0)try{let e=await fetch("/api/controles/vincular-notas",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({controleId:l.id,notasIds:n})});if(!e.ok){let o=await e.json().catch(()=>({}));console.warn("Aviso ao vincular notas:",o)}l.notas=n.map(e=>({id:e}))}catch(e){console.error("Erro ao vincular notas:",e)}try{let o=await fetch("/api/controles",{credentials:"include",headers:{Accept:"application/json"}});if(o.ok){let t=await o.json();e({controles:t})}}catch(e){console.error("Erro ao atualizar lista de controles:",e)}return l}catch(e){if(console.error("Erro na fun\xe7\xe3o criarControle:",e),e instanceof Error)throw e;throw Error("Erro desconhecido ao criar controle")}},vincularNotas:async(e,o)=>{await fetch("/api/controles/vincular-notas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({controleId:e,notasIds:o})}),await Promise.all([a.getState().fetchNotas(),a.getState().fetchControles()])},finalizarControle:async e=>{await fetch("/api/controles/finalizar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({controleId:e})}),await a.getState().fetchControles()},atualizarControle:async(e,o)=>{console.log("Iniciando atualizarControle...");try{console.log("Enviando requisi\xe7\xe3o para /api/controles/atualizar com dados:",{controleId:e,...o,qtdPallets:Number(o.qtdPallets)||0});let t=await fetch("/api/controles/atualizar",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},body:JSON.stringify({controleId:e,...o,qtdPallets:Number(o.qtdPallets)||0})});if(console.log("Resposta recebida, status:",t.status),!t.ok){console.error("Erro na resposta da API:",t.status,t.statusText);let e=await t.json().catch(()=>({}));throw console.error("Detalhes do erro:",e),Error(e.error||"Erro ao atualizar controle")}console.log("Atualizando lista de controles...");let r=await t.json();return await a.getState().fetchControles(),console.log("Controle atualizado com sucesso:",r),r}catch(e){return console.error("Erro ao atualizar controle:",e),null}}}))},83:function(e,o,t){var a=t(7294),r="function"==typeof Object.is?Object.is:function(e,o){return e===o&&(0!==e||1/e==1/o)||e!=e&&o!=o},n=a.useState,s=a.useEffect,i=a.useLayoutEffect,l=a.useDebugValue;function c(e){var o=e.getSnapshot;e=e.value;try{var t=o();return!r(e,t)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,o){return o()}:function(e,o){var t=o(),a=n({inst:{value:t,getSnapshot:o}}),r=a[0].inst,d=a[1];return i(function(){r.value=t,r.getSnapshot=o,c(r)&&d({inst:r})},[e,t,o]),s(function(){return c(r)&&d({inst:r}),e(function(){c(r)&&d({inst:r})})},[e]),l(t),t};o.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:d},6251:function(e,o,t){var a=t(7294),r=t(1688),n="function"==typeof Object.is?Object.is:function(e,o){return e===o&&(0!==e||1/e==1/o)||e!=e&&o!=o},s=r.useSyncExternalStore,i=a.useRef,l=a.useEffect,c=a.useMemo,d=a.useDebugValue;o.useSyncExternalStoreWithSelector=function(e,o,t,a,r){var u=i(null);if(null===u.current){var p={hasValue:!1,value:null};u.current=p}else p=u.current;var h=s(e,(u=c(function(){function e(e){if(!l){if(l=!0,s=e,e=a(e),void 0!==r&&p.hasValue){var o=p.value;if(r(o,e))return i=o}return i=e}if(o=i,n(s,e))return o;var t=a(e);return void 0!==r&&r(o,t)?(s=e,o):(s=e,i=t)}var s,i,l=!1,c=void 0===t?null:t;return[function(){return e(o())},null===c?void 0:function(){return e(c())}]},[o,t,a,r]))[0],u[1]);return l(function(){p.hasValue=!0,p.value=h},[h]),d(h),h}},1688:function(e,o,t){e.exports=t(83)},2798:function(e,o,t){e.exports=t(6251)},4529:function(e,o,t){t.d(o,{Ue:function(){return p}});let a=e=>{let o;let t=new Set,a=(e,a)=>{let r="function"==typeof e?e(o):e;if(!Object.is(r,o)){let e=o;o=(null!=a?a:"object"!=typeof r||null===r)?r:Object.assign({},o,r),t.forEach(t=>t(o,e))}},r=()=>o,n={setState:a,getState:r,getInitialState:()=>s,subscribe:e=>(t.add(e),()=>t.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},s=o=e(a,r,n);return n},r=e=>e?a(e):a;var n=t(7294),s=t(2798);let{useDebugValue:i}=n,{useSyncExternalStoreWithSelector:l}=s,c=!1,d=e=>e,u=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let o="function"==typeof e?r(e):e,t=(e,t)=>(function(e,o=d,t){t&&!c&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),c=!0);let a=l(e.subscribe,e.getState,e.getServerState||e.getInitialState,o,t);return i(a),a})(o,e,t);return Object.assign(t,o),t},p=e=>e?u(e):u}}]);